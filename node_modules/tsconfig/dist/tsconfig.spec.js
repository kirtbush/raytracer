var chai_1 = require('chai');
var path_1 = require('path');
var tsconfig = require('./tsconfig');
describe('tsconfig', function () {
    var tests = [
        {
            path: path_1.join(__dirname, '../..'),
            error: 'No config file found'
        },
        {
            path: path_1.join(__dirname, '../tests/invalidfile'),
            error: "Unexpected token 's' at 1:1 in " + path_1.join(__dirname, '../tests/invalidfile/tsconfig.json') + "\nsome random string\n^"
        },
        {
            path: path_1.join(__dirname, '../tests/valid'),
            result: {
                compilerOptions: {
                    target: 'es5',
                    module: 'commonjs',
                    declaration: false,
                    noImplicitAny: true,
                    out: '../../built/local/tsc.js',
                    removeComments: true,
                    sourceMap: true,
                    preserveConstEnums: true
                },
                files: [
                    path_1.join(__dirname, '../tests/valid/src/foo.ts')
                ],
                exclude: []
            },
            filename: path_1.join(__dirname, '../tests/valid/tsconfig.json')
        },
        {
            path: path_1.join(__dirname, '../tests/bom'),
            result: {
                compilerOptions: {
                    target: 'es5',
                    module: 'commonjs',
                    declaration: false,
                    noImplicitAny: true,
                    outDir: 'dist',
                    removeComments: true,
                    sourceMap: true,
                    preserveConstEnums: true
                },
                files: [
                    path_1.join(__dirname, '../tests/bom/src/bom.ts')
                ],
                exclude: []
            },
            filename: path_1.join(__dirname, '../tests/bom/tsconfig.json')
        },
        {
            path: path_1.join(__dirname, '../tests/exclude'),
            result: {
                compilerOptions: {
                    target: 'es5',
                    module: 'commonjs',
                    declaration: false,
                    noImplicitAny: true,
                    out: '../../built/local/tsc.js',
                    removeComments: true,
                    sourceMap: true,
                    preserveConstEnums: true
                },
                files: [
                    path_1.join(__dirname, '../tests/exclude/included/foo.ts')
                ],
                exclude: [
                    path_1.join(__dirname, '../tests/exclude/excluded'),
                    path_1.join(__dirname, '../tests/exclude/cwd.ts')
                ]
            },
            filename: path_1.join(__dirname, '../tests/exclude/tsconfig.json')
        },
        {
            path: path_1.join(__dirname, '../tests/cwd'),
            result: {
                compilerOptions: {
                    target: 'es5',
                    module: 'commonjs',
                    declaration: false,
                    noImplicitAny: true,
                    outDir: 'dist',
                    removeComments: true,
                    sourceMap: true,
                    preserveConstEnums: true
                },
                files: [
                    path_1.join(__dirname, '../tests/cwd/foo.d.ts'),
                    path_1.join(__dirname, '../tests/cwd/foo.ts'),
                    path_1.join(__dirname, '../tests/cwd/foo.tsx')
                ],
                exclude: []
            },
            filename: path_1.join(__dirname, '../tests/cwd/tsconfig.json')
        },
        {
            path: path_1.join(__dirname, '../tests/glob'),
            result: {
                compilerOptions: {
                    declaration: false,
                    module: 'commonjs',
                    noImplicitAny: false,
                    removeComments: true,
                    target: 'es5'
                },
                exclude: [],
                files: [
                    path_1.join(__dirname, '../tests/glob/src/foo.ts')
                ],
                filesGlob: ['src/**/*.ts']
            },
            filename: path_1.join(__dirname, '../tests/glob/tsconfig.json')
        },
        {
            path: path_1.join(__dirname, '../tests/glob-negation'),
            result: {
                compilerOptions: {
                    declaration: false,
                    module: 'commonjs',
                    noImplicitAny: false,
                    removeComments: true,
                    target: 'es5'
                },
                exclude: [],
                files: [
                    path_1.join(__dirname, '../tests/glob-negation/src/foo.ts')
                ],
                filesGlob: ['!test/**/*']
            },
            filename: path_1.join(__dirname, '../tests/glob-negation/tsconfig.json')
        },
        {
            path: path_1.join(__dirname, '../tests/glob-multi'),
            result: {
                compilerOptions: {
                    declaration: false,
                    module: 'commonjs',
                    noImplicitAny: false,
                    removeComments: true,
                    target: 'es5'
                },
                exclude: [],
                files: [
                    path_1.join(__dirname, '../tests/glob-multi/a/foo.ts'),
                    path_1.join(__dirname, '../tests/glob-multi/b/foo.ts')
                ],
                filesGlob: ['a/**/*.ts', 'b/**/*.ts']
            },
            filename: path_1.join(__dirname, '../tests/glob-multi/tsconfig.json')
        }
    ];
    describe('sync', function () {
        tests.forEach(function (test) {
            describe(test.path, function () {
                it('should try to find config', function () {
                    var result;
                    try {
                        result = tsconfig.loadSync(test.path);
                    }
                    catch (err) {
                        chai_1.expect(err.message).to.equal(test.error);
                        return;
                    }
                    chai_1.expect(result).to.deep.equal(test.result);
                });
                if (test.filename) {
                    it('should resolve filename', function () {
                        chai_1.expect(tsconfig.resolveSync(test.path)).to.equal(test.filename);
                    });
                }
            });
        });
    });
    describe('async', function () {
        tests.forEach(function (test) {
            describe(test.path, function () {
                it('should try to find config', function (done) {
                    tsconfig.load(test.path, function (err, config) {
                        if (err) {
                            chai_1.expect(err.message).to.equal(test.error);
                        }
                        else {
                            chai_1.expect(config).to.deep.equal(test.result);
                        }
                        return done();
                    });
                });
                if (test.filename) {
                    it('should resolve filename', function (done) {
                        tsconfig.resolve(test.path, function (err, filename) {
                            chai_1.expect(filename).to.equal(test.filename);
                            return done(err);
                        });
                    });
                }
            });
        });
    });
});
//# sourceMappingURL=tsconfig.spec.js.map